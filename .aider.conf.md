# FairArena - Aider AI Context

You are working on **FairArena**, a production-ready full-stack skill assessment platform.

## Quick Facts

**Live:** https://www.fairarena.app
**Tech:** React 19 + Express 5 + Prisma 7 + PostgreSQL + Redis
**Auth:** Clerk (JWT)
**Jobs:** Inngest (34+ functions)
**AI:** Google Gemini
**Status:** Production

## Stack Details

**Frontend:** React 19.2, TypeScript 5.9, Vite 7.3, TailwindCSS 4.1, Radix UI
**Backend:** Node.js 20, Express 5.2, Prisma 7.2, PostgreSQL 15+, Redis 7
**Tools:** Clerk, Inngest, Resend, Razorpay, OpenTelemetry, Arcjet
**Package Manager:** pnpm 10.26

## Architecture

- **API:** RESTful, 70+ endpoints on `/api/v1`
- **Database:** 30+ Prisma models with RBAC
- **Caching:** Redis (Upstash)
- **Jobs:** Event-driven (Inngest)
- **Observability:** OpenTelemetry → SigNoz
- **Container:** Docker Compose

## File Structure

```
Backend/src/
  config/           - DB, Redis configs
  controllers/v1/   - Request handlers (31)
  email/templates/  - React Email (19)
  inngest/v1/       - Background jobs (34+)
  middleware/       - Auth, security
  routes/v1/        - API routes (17)
  services/v1/      - Business logic
  utils/            - Helpers
  index.ts          - Entry point

Frontend/src/
  components/       - UI components (61)
  pages/            - Pages (27)
  contexts/         - React contexts (7)
  hooks/            - Custom hooks
  services/         - API layer

prisma/schema.prisma - 30+ models
```

## Key Models

User, Profile, Settings, Organization, Team, Project, Payment, CreditTransaction, Plan, Notification, Support, Feedback

All with RBAC, audit logs, soft deletes

## Code Standards

**TypeScript:** Strict mode, explicit types, Zod validation
**React:** Functional components, hooks, TypeScript props
**API:** Controller → Service pattern, try-catch, Zod validation
**Database:** Prisma transactions for multi-table, optimize with select
**Cache:** Redis with TTL, invalidate on mutation
**Logging:** Winston (structured, no secrets)
**Security:** Clerk JWT, Arcjet rate limiting, Helmet headers

## Common Patterns

### API Endpoint

```typescript
import { z } from 'zod';
const schema = z.object({ email: z.string().email() });

export const handler = async (req: Request, res: Response) => {
  try {
    const data = schema.parse(req.body);
    const result = await service.execute(data);
    return res.json({ success: true, data: result });
  } catch (error) {
    logger.error('Error', { error });
    return res.status(500).json({ success: false, error: 'Error' });
  }
};
```

### React Component

```tsx
interface Props {
  userId: string;
}

export const Card: FC<Props> = ({ userId }) => {
  const [data, setData] = useState<User | null>(null);

  useEffect(() => {
    api.get(`/users/${userId}`).then((r) => setData(r.data));
  }, [userId]);

  return data ? <div>{data.name}</div> : <Spinner />;
};
```

### Database Query

```typescript
// Transaction
await prisma.$transaction(async (tx) => {
  await tx.payment.update({ ... });
  await tx.creditTransaction.create({ ... });
});

// Optimized query
const user = await prisma.user.findUnique({
  where: { userId },
  select: { id: true, email: true, profile: { select: { bio: true } } }
});
```

### Caching

```typescript
import { redis } from '@/config/redis';

// Get with fallback
const data = (await redis.get(key)) ?? (await db.fetch());

// Set with TTL
await redis.set(key, JSON.stringify(data), 'EX', 3600);
```

## Environment Variables

**Backend:** DATABASE_URL, CLERK_SECRET_KEY, CLERK_WEBHOOK_SECRET, INNGEST_SIGNING_KEY, INNGEST_EVENT_KEY, UPSTASH_REDIS_REST_URL, UPSTASH_REDIS_REST_TOKEN, RESEND_API_KEY, RAZORPAY_KEY_ID, RAZORPAY_KEY_SECRET, GOOGLE_GEMINI_API_KEY

**Frontend:** VITE_CLERK_PUBLISHABLE_KEY, VITE_API_BASE_URL, VITE_SOCKET_URL, VITE_RAZORPAY_KEY_ID

## Critical Rules

1. TypeScript strict mode - No `any`
2. Zod validation - All inputs
3. Prisma transactions - Multi-table writes
4. Redis caching - With TTL + invalidation
5. Winston logging - Never log secrets
6. Arcjet rate limiting - Public routes
7. Try-catch - All async operations
8. Clerk JWT - Protected routes
9. Sentry - Error tracking
10. Idempotency - Payments/credits

## Development

```bash
pnpm install
cd Backend && pnpm db:generate && pnpm db:migrate
cd Backend && pnpm dev              # :3000
cd Backend && pnpm dev:inngest      # :8288
cd Frontend && pnpm dev             # :5173
```

## Naming

- Files: camelCase (utils), PascalCase (components)
- Functions: camelCase
- Constants: UPPER_SNAKE_CASE
- Types: PascalCase

## Resources

- API Docs: http://localhost:3000/api-docs
- Postman: Backend/postman/
- Architecture: Backend/docs/SYSTEM_ARCHITECTURE.md
- Database: Backend/docs/DATABASE_DESIGN.md

## Author

Saksham Goel (@Saksham-Goel1107)
contact@fairarena.app

---

When editing files:

- Use TypeScript strict types
- Validate inputs with Zod
- Follow existing patterns
- Add try-catch for async
- Log errors (Winston)
- Cache aggressively
- Test edge cases
