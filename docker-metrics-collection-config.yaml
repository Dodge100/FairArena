# Docker Container Metrics Collection Configuration
# Collects CPU, Memory, Network, and Disk metrics from Docker containers

receivers:
  # Docker Stats Receiver - queries Docker daemon's container stats API
  docker_stats:
    endpoint: unix:///var/run/docker.sock
    api_version: "1.52"
    collection_interval: 30s
    timeout: 20s
    # Container metrics to collect
    metrics:
      # CPU Metrics
      container.cpu.utilization:
        enabled: true
      container.cpu.usage.total:
        enabled: true
      container.cpu.usage.kernelmode:
        enabled: true
      container.cpu.usage.usermode:
        enabled: true
      container.cpu.throttling_data.throttled_time:
        enabled: true
      # Memory Metrics
      container.memory.percent:
        enabled: true
      container.memory.usage.limit:
        enabled: true
      container.memory.usage.total:
        enabled: true
      container.memory.usage.max:
        enabled: true
      container.memory.cache:
        enabled: true
      container.memory.rss:
        enabled: true
      # Network Metrics
      container.network.io.usage.rx_bytes:
        enabled: true
      container.network.io.usage.tx_bytes:
        enabled: true
      container.network.io.usage.rx_dropped:
        enabled: true
      container.network.io.usage.tx_dropped:
        enabled: true
      container.network.io.usage.rx_errors:
        enabled: true
      container.network.io.usage.tx_errors:
        enabled: true
      container.network.io.usage.rx_packets:
        enabled: true
      container.network.io.usage.tx_packets:
        enabled: true
      # Block I/O Metrics
      container.blockio.io_service_bytes_recursive:
        enabled: true
      container.blockio.io_serviced_recursive:
        enabled: true
      # Pids
      container.pids.count:
        enabled: true
      container.pids.limit:
        enabled: true
      # Uptime
      container.uptime:
        enabled: true
      # Restarts
      container.restarts:
        enabled: true

processors:
  # Resource detection for Docker metadata
  resourcedetection/docker:
    detectors: [env, docker, system]
    timeout: 2s
    override: false
    system:
      hostname_sources: ["os"]

  # Batch processor for efficient export
  batch/docker:
    send_batch_size: 1000
    timeout: 10s

  # Add service name for identification
  resource/docker:
    attributes:
      - key: service.name
        value: fairarena-docker
        action: insert
      - key: deployment.environment
        value: production
        action: insert

exporters:
  # Export to SigNoz Cloud
  otlp/docker-metrics:
    endpoint: "${env:OTLP_DESTINATION_ENDPOINT}"
    tls:
      insecure: false
    headers:
      "signoz-ingestion-key": "${env:SIGNOZ_INGESTION_KEY}"

  # Debug exporter for troubleshooting (optional)
  # debug:
  #   verbosity: basic

service:
  pipelines:
    metrics/docker:
      receivers: [docker_stats]
      processors: [resourcedetection/docker, resource/docker, batch/docker]
      exporters: [otlp/docker-metrics]
